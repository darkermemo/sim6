<Extension json>
    Module xm_json
</Extension>

<Input in>
    Module im_msvistalog
    Query <QueryList> \
            <Query Id="0"> \
              <Select Path="Microsoft-Windows-Sysmon/Operational">*</Select> \
            </Query> \
          </QueryList>
    Exec $tenant_id = {{TENANT_ID}};
    Exec $source_id = "{{SOURCE_ID}}";
    Exec $source_type = "windows_sysmon";
</Input>

<Output out>
    Module om_http
    URL "{{BASE_URL}}/api/v2/ingest/ndjson"
    HTTPSAllowUntrusted TRUE
    ContentType "application/x-ndjson"
    AddHeader "X-API-Key: {{API_KEY}}"
    Exec to_json();
</Output>

<Route r>
    Path in => out
</Route>
