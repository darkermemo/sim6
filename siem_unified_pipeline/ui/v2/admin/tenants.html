<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Admin â€¢ Tenants</title>
  <link rel="stylesheet" href="/dev/ui/assets/style.css"/>
</head>
<body>
<div class="container">
  <h1>Tenants</h1>
  <div id="err" class="error" role="alert" aria-live="assertive" style="display:none"></div>
  <table id="tbl" aria-label="Tenants table">
    <thead><tr><th>Tenant</th><th>Status</th><th>Retention</th><th>EPS</th><th>Burst</th><th>Live EPS</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</div>
<script>
const $=s=>document.querySelector(s);
const BASE='/api/v2/admin';
async function req(path, init){ const r=await fetch(path,{headers:{'content-type':'application/json'},...init}); if(!r.ok){ const msg='HTTP '+r.status; const err=$('#err'); err.textContent=msg; err.style.display='block'; throw new Error(msg);} return r.json(); }
async function load(){
  const data = await req(`${BASE}/tenants`);
  const rows = data.items||[];
  const tbody = document.querySelector('#tbl tbody');
  const eps = await fetch('/api/v2/metrics/eps').then(r=>r.json()).catch(()=>({per_tenant:{tenants:{}}}));
  const tmap = (eps && eps.per_tenant && eps.per_tenant.tenants) ? eps.per_tenant.tenants : {};
  tbody.innerHTML = rows.map(r=>`<tr>
    <td>${r.tenant_id}</td>
    <td>${r.status}</td>
    <td><input type="number" min="1" value="${r.retention_days}" data-k="retention_days" data-id="${r.tenant_id}"></td>
    <td><input type="number" min="1" value="${r.eps_quota}" data-k="eps_limit" data-id="${r.tenant_id}"></td>
    <td><input type="number" min="1" value="${r.burst_eps}" data-k="burst_limit" data-id="${r.tenant_id}"></td>
    <td><span aria-live="polite">${(tmap[r.tenant_id]?.current_eps ?? 0).toFixed(2)}</span></td>
    <td><button data-id="${r.tenant_id}">Save</button></td>
  </tr>`).join('');
  tbody.querySelectorAll('button').forEach(btn=>{
    btn.onclick = async ()=>{
      const id=btn.getAttribute('data-id');
      const tr=btn.closest('tr');
      const get=(k)=>tr.querySelector(`[data-k="${k}"]`).value;
      const limits={ eps_limit:parseInt(get('eps_limit'),10), burst_limit:parseInt(get('burst_limit'),10), retention_days:parseInt(get('retention_days'),10) };
      try {
        await req(`${BASE}/tenants/${id}/limits`, { method:'PUT', body: JSON.stringify(limits)});
        alert('Saved');
      } catch (e) {
        const err=$('#err'); err.textContent='Save failed: '+e; err.style.display='block';
      }
    };
  });
}
load().catch(()=>{ const e=$('#err'); e.textContent='Failed to load tenants'; e.style.display='block'; });
</script>
</body>
</html>


