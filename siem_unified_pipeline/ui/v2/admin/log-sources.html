<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Log Sources</title>
  <link rel="stylesheet" href="/ui/v2/admin/_shared.css"/>
  <style>.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center}.card{background:#fff;padding:16px;border-radius:6px;min-width:420px}.toast{position:fixed;right:12px;bottom:12px;background:#222;color:#fff;padding:8px 12px;border-radius:4px;display:none}</style>
</head>
<body>
  <div class="container" role="main">
    <h2>Log Sources</h2>
    <div>
      <label>Tenant <input id="tenant" value="default"/></label>
      <label><input type="checkbox" id="inc"/> include config</label>
      <button id="refresh">Refresh</button>
      <button id="new">New Source</button>
    </div>
    <table id="tbl"><thead><tr><th>id</th><th>name</th><th>kind</th><th>enabled</th><th>updated_at</th><th>actions</th></tr></thead><tbody></tbody></table>
  </div>
  <div id="modal" class="modal" aria-hidden="true"><div class="card">
    <h3 id="m_title">Create Source</h3>
    <label>Name <input id="m_name"/></label>
    <label>Kind <input id="m_kind" value="vector"/></label>
    <label>Config <textarea id="m_config" rows="6">{"endpoint":"http://127.0.0.1:9999/api/v2/ingest/bulk"}</textarea></label>
    <div id="m_cfg_err" style="color:#b91c1c;display:none">Invalid JSON</div>
    <label><input type="checkbox" id="m_enabled" checked/> Enabled</label>
    <div style="margin-top:8px" class="row">
      <button id="m_save">Save</button>
      <button id="m_close">Close</button>
      <button id="m_copy">Copy Vector Config</button>
      <button id="m_test">Test Ingest</button>
    </div>
    <pre id="m_vec" style="margin-top:8px"></pre>
  </div></div>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <script>
  (function(){
  const $= window.$ || (s=>document.querySelector(s)); const toast= window.toast || (m=>{const t=$('#toast'); if(!t) return; t.textContent=m;t.style.display='block';setTimeout(()=>t.style.display='none',1500)});
  async function api(p,o){ const r=await fetch(p,{headers:{'content-type':'application/json'},...o}); if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); }
  function vectorConfig(endpoint){ return `[sources.in]\n`+
  `type = "http_server"\n`+
  `address = "0.0.0.0:9000"\n\n`+
  `[sinks.out]\n`+
  `type = "http"\n`+
  `inputs = ["in"]\n`+
  `uri = "${endpoint}"\n`+
  `encoding.codec = "json"\n`; }
  async function load(){ const t=$('#tenant').value.trim(); const qs=new URLSearchParams({tenant_id:t}); if($('#inc').checked) qs.set('include_config','1'); const j=await api('/api/v2/admin/log-sources?'+qs.toString()); const tb=$('#tbl tbody'); tb.innerHTML=(j.items||[]).map(x=>`<tr><td>${x.source_id}</td><td>${x.name}</td><td>${x.kind}</td><td>${x.enabled? 'yes':'no'}</td><td>${x.updated_at}</td><td><button data-act="edit" data-id="${x.source_id}">Edit</button> <button data-act="del" data-id="${x.source_id}">Delete</button></td></tr>`).join(''); tb.querySelectorAll('button').forEach(b=> b.onclick=onRow); }
  function parseConfigOrErr(){ try{ const v=JSON.parse($('#m_config').value||'{}'); $('#m_cfg_err').style.display='none'; return v; }catch{ $('#m_cfg_err').style.display='block'; throw new Error('Invalid JSON'); } }
  $('#m_config').addEventListener('input', ()=>{ try{ JSON.parse($('#m_config').value||'{}'); $('#m_cfg_err').style.display='none'; }catch{ $('#m_cfg_err').style.display='block'; } });
  async function onRow(e){ const id=e.currentTarget.getAttribute('data-id'); const act=e.currentTarget.getAttribute('data-act'); const t=$('#tenant').value.trim(); if(act==='del'){ await api(`/api/v2/admin/log-sources/${id}?tenant_id=${encodeURIComponent(t)}`,{method:'DELETE'}); toast('Deleted'); await load(); return; } const j=await api(`/api/v2/admin/log-sources/${id}?tenant_id=${encodeURIComponent(t)}&include_config=1`); $('#m_title').textContent='Edit Source'; $('#m_name').value=j.name; $('#m_kind').value=j.kind; $('#m_config').value=j.config; $('#m_enabled').checked=!!j.enabled; try{ const ep = JSON.parse(j.config||'{}').endpoint||''; $('#m_vec').textContent=vectorConfig(ep);}catch(_){} $('#modal').style.display='flex'; $('#m_save').onclick=async()=>{ try{ const cfg=parseConfigOrErr(); await api('/api/v2/admin/log-sources/'+id,{method:'PUT', body: JSON.stringify({ tenant_id:t, name:$('#m_name').value.trim(), kind:$('#m_kind').value.trim(), config: cfg, enabled: $('#m_enabled').checked?1:0 })}); toast('Updated'); $('#modal').style.display='none'; await load(); }catch(err){ toast(String(err)); } } }
  $('#new').onclick=()=>{ $('#m_title').textContent='Create Source'; $('#m_name').value=''; $('#m_kind').value='vector'; $('#m_config').value='{"endpoint":"http://127.0.0.1:9999/api/v2/ingest/bulk"}'; $('#m_enabled').checked=true; $('#m_vec').textContent=''; $('#m_cfg_err').style.display='none'; $('#modal').style.display='flex'; $('#m_save').onclick=async()=>{ try{ const t=$('#tenant').value.trim(); const cfg=parseConfigOrErr(); const j=await api('/api/v2/admin/log-sources',{method:'POST', body: JSON.stringify({ tenant_id:t, name:$('#m_name').value.trim(), kind:$('#m_kind').value.trim(), config: cfg, enabled: $('#m_enabled').checked?1:0 })}); toast('Created'); try{ $('#m_vec').textContent=vectorConfig(cfg.endpoint||''); }catch(_){} await load(); }catch(err){ toast(String(err)); } } };
  // Copy Vector config
  $('#m_copy').onclick = async ()=>{ try{ await navigator.clipboard.writeText($('#m_vec').textContent||''); toast('Copied'); }catch(e){ toast('Copy failed'); } };
  // Test Ingest against API directly
  $('#m_test').onclick = async ()=>{ try{ const t=$('#tenant').value.trim()||'default'; const now=Math.floor(Date.now()/1000); const ev = {event_id:'ls-test-'+now,event_timestamp:now,tenant_id:t,event_category:'app',message:'ui test',raw_event:'{}',metadata:'{}',source_type:'ui',created_at:now,retention_days:30}; const line=JSON.stringify(ev); const r = await fetch(`/api/v2/ingest/bulk?tenant=${encodeURIComponent(t)}`, { method:'POST', headers:{'content-type':'application/x-ndjson'}, body: line }); toast(r.ok? 'Ingest OK' : ('Ingest '+r.status)); }catch(e){ toast(e.message); } };
  $('#m_close').onclick=()=>$('#modal').style.display='none'; $('#inc').onchange=load; $('#refresh').onclick=load; load().catch(err=>toast(String(err)));
  })();
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Log Sources</title>
  <link rel="stylesheet" href="/ui/assets/style.css"/>
</head>
<body>
  <header>
    <div class="title">SIEM Admin</div>
    <nav aria-label="Admin">
      <a href="/ui/v2/admin/index.html">Home</a>
      <a href="/ui/v2/admin/tenants.html">Tenants</a>
      <a href="/ui/v2/admin/log-sources.html">Log Sources</a>
      <a href="/ui/v2/admin/parsers.html">Parsers</a>
      <a href="/ui/v2/admin/streaming.html">Streaming</a>
      <a href="/ui/v2/admin/rules.html">Rules</a>
      <a href="/ui/v2/admin/storage.html">Storage</a>
      <a href="/ui/v2/admin/api-keys.html">API Keys</a>
    </nav>
  </header>
  <main>
    <h1>Log Sources</h1>
    <div>
      <label>Tenant <input id="tenant" value="default"></label>
      <label>Name <input id="name"></label>
      <label>Type <input id="type" placeholder="syslog/json"></label>
      <button data-testid="btn-create-source" id="create">Create</button>
      <button data-testid="btn-gen-vector" id="genvec">Generate Vector Config</button>
    </div>
    <pre id="cfg" data-testid="json-preview"></pre>
    <table data-testid="table-log-sources" id="tbl">
      <thead><tr><th>tenant</th><th>name</th><th>type</th></tr></thead>
      <tbody></tbody>
    </table>
    <button data-testid="btn-ingest-sample" id="ingest">Ingest Sample</button>
    <div id="toast" data-testid="toast"></div>
  </main>
  <script>
  function toast(m){ const t=document.getElementById('toast'); t.textContent=m; setTimeout(()=>t.textContent='',3000); }
  async function list(){
    // Placeholder: if no backend table, show what we have in-memory
    const tb = document.querySelector('#tbl tbody');
    tb.innerHTML = '';
    const tenant = document.getElementById('tenant').value || 'default';
    const items = JSON.parse(localStorage.getItem('log_sources_'+tenant) || '[]');
    items.forEach(s=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${s.tenant}</td><td>${s.name}</td><td>${s.type}</td>`; tb.appendChild(tr); });
  }
  document.getElementById('create').onclick = ()=>{
    const tenant = document.getElementById('tenant').value||'default';
    const name = document.getElementById('name').value||'';
    const type = document.getElementById('type').value||'';
    const key = 'log_sources_'+tenant;
    const arr = JSON.parse(localStorage.getItem(key)||'[]');
    arr.push({tenant,name,type,ts:Date.now()});
    localStorage.setItem(key, JSON.stringify(arr));
    list(); toast('Created');
  };
  document.getElementById('genvec').onclick = ()=>{
    const tenant = document.getElementById('tenant').value||'default';
    const name = document.getElementById('name').value||'source';
    const cfg = `sources.${tenant}_${name} { type = "file" path = "/var/log/app.log" }`;
    document.getElementById('cfg').textContent = cfg;
  };
  document.getElementById('ingest').onclick = async ()=>{
    const tenant = document.getElementById('tenant').value||'default';
    const now = Math.floor(Date.now()/1000);
    const rows = [1,2].map(i=>JSON.stringify({event_id:`ui-src-${i}-${now}`,event_timestamp:now,tenant_id:tenant,event_category:'app',event_action:'log',event_outcome:'success',message:'sample from ui',raw_event:'{}',metadata:'{}',source_type:'ui',created_at:now,retention_days:30})).join('\n');
    const r = await fetch(`/api/v2/ingest/bulk?tenant=${tenant}`, {method:'POST', headers:{'content-type':'application/x-ndjson'}, body: rows});
    toast(r.ok? 'Ingest OK' : `Ingest status ${r.status}`);
  };
  list();
  </script>
</body>
</html>

<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" href="/ui/v2/admin/_shared.css"/>
<title>Log Sources · Admin</title>
</head><body>
<header>
  <div class="title">Log Sources</div>
  <nav aria-label="Admin">
    <a href="./index.html">Home</a><a href="./tenants.html">Tenants</a>
    <a href="./log-sources.html">Log Sources</a><a href="./parsers.html">Parsers</a>
    <a href="./cim.html">CIM Explorer</a><a href="./sigma.html">Sigma</a><a href="./ingestors.html">Ingestors</a>
  </nav>
  <div style="margin-left:auto" class="small">Tenant:
    <input id="tenant" value="default" style="width:120px"/>
  </div>
</header>
<main>
  <section class="card grid cols-2">
    <div>
      <h3>Paste sample (raw or JSON)</h3>
      <textarea id="sample" placeholder="Paste one or more lines…"></textarea>
      <div class="row">
        <button id="btn-detect">Detect</button>
        <button class="primary" id="btn-normalize" data-testid="normalize">Normalize</button>
      </div>
      <div class="small">Detected: <span id="det-vendor" class="badge">—</span> <span id="det-type" class="badge">—</span> <span id="det-conf" class="badge">—</span></div>
    </div>
    <div>
      <h3>Dry-run as rule</h3>
      <label>Filter (DSL JSON)</label>
      <textarea id="dsl" spellcheck="false">{ "search": { "tenant_ids": ["default"], "time_range": { "last_seconds": 1800 }, "where": { "op":"contains", "args": ["message","fail"] } } }</textarea>
      <div class="row">
        <button id="btn-compile">Compile</button>
        <button class="primary" id="btn-exec">Execute</button>
      </div>
      <pre id="sql" class="small" style="max-height:140px"></pre>
      <div class="small">Rows: <span id="rows">—</span></div>
    </div>
  </section>

  <section class="card">
    <h3>Normalize preview</h3>
    <div class="small">Coverage: <span id="cov" class="badge">—</span> Signals: <span id="sig" class="badge">—</span></div>
    <table>
      <thead><tr><th>event_timestamp</th><th>tenant_id</th><th>event_category</th><th>event_action</th><th>user_name</th><th>source_ip</th><th>message</th></tr></thead>
    </table>
    <div id="norm" class="small">—</div>
  </section>

  <section class="card">
    <h3>Load guidance</h3>
    <pre id="loadcmd" class="small"># After you save sample to /tmp/sample.ndjson
siem load-ch --file /tmp/sample.ndjson --table dev.events</pre>
  </section>
</main>
<div id="toast" class="toast"></div>
<script src="/ui/v2/admin/_shared.js"></script>
<script>
setCurrentNav('log-sources.html');
const tEl = document.querySelector('#tenant');
document.querySelector('#btn-detect').onclick = async () => {
  const first = document.querySelector('#sample').value.split('\n').filter(Boolean)[0]||'';
  if (!first) return toast('Paste a sample first','error');
  try {
    const body = (/^\s*[{[]/.test(first)) ? { record: JSON.parse(first) } : { raw: first };
    const r = await api('/api/v2/parse/detect', { method:'POST', body: JSON.stringify(body) });
    document.querySelector('#det-vendor').textContent = r.vendor||'—'; document.querySelector('#det-type').textContent = r.type||'—'; document.querySelector('#det-conf').textContent = String(r.confidence??'—');
  } catch(e){ toast(e.message,'error'); }
};
document.querySelector('#btn-normalize').onclick = async () => {
  const lines = document.querySelector('#sample').value.split('\n').filter(Boolean);
  if (!lines.length) return toast('Paste a sample first','error');
  const recs = []; for (const L of lines.slice(0,20)) { if (/^\s*[{[]/.test(L)) recs.push(JSON.parse(L)); else recs.push(L); }
  const body = { tenant_id: tEl.value.trim()||'default', samples: recs };
  try {
    const r = await api('/api/v2/parse/normalize', { method:'POST', body: JSON.stringify(body) });
    document.querySelector('#cov').textContent = (r.coverage!=null? r.coverage : '—');
    document.querySelector('#sig').textContent = (r.signals?.join(', ') || '—');
    const pretty = (r.records||[]).slice(0,10).map(rec=>{
      const out={}; Object.entries(rec||{}).forEach(([k,v])=>{ out[k]=window.formatMaybeTs(k,v); }); return out;
    });
    document.querySelector('#norm').textContent = JSON.stringify(pretty, null, 2);
  } catch(e){ toast(e.message,'error'); }
};
document.querySelector('#btn-compile').onclick = async () => {
  try {
    const d = JSON.parse(document.querySelector('#dsl').value);
    const r = await api('/api/v2/search/compile', { method:'POST', body: JSON.stringify(d) });
    document.querySelector('#sql').textContent = r.where_sql || JSON.stringify(r);
  } catch(e){ toast(e.message,'error'); }
};
document.querySelector('#btn-exec').onclick = async () => {
  try {
    const d = JSON.parse(document.querySelector('#dsl').value);
    const r = await api('/api/v2/search/execute', { method:'POST', body: JSON.stringify({ dsl: d }) });
    document.querySelector('#rows').textContent = (r?.data?.data?.length ?? 0);
  } catch(e){ toast(e.message,'error'); }
};
</script>
</body></html>
<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Admin • Log Sources</title>
  <link rel="stylesheet" href="/dev/ui/assets/style.css"/>
  <style>
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .ribbon { padding: 6px 10px; border-radius: 999px; display:inline-block; background:#eef; }
    .badge { border-radius: 999px; background:#eee; padding:2px 8px; margin-right:6px; }
    table { width:100%; border-collapse: collapse; font-size: 12px; }
    th, td { border:1px solid #e5e7eb; padding:6px; text-align:left; }
    .missing { color:#999; font-style: italic; }
    .pill { border-radius: 999px; padding: 2px 8px; font-weight:600; }
    .pill.ok { background:#e6ffed; color:#03543f; }
    .pill.warn { background:#fffbea; color:#723b13; }
    .sidebar { max-height: 320px; overflow: auto; border:1px solid #e5e7eb; padding:8px; }
    .row { display:flex; gap:8px; align-items:center; }
    .error { background:#fee2e2; color:#7f1d1d; padding:8px; border-radius:8px; margin:8px 0; position:sticky; top:0 }
  </style>
</head>
<body>
<!--#include file="../../_nav.html" -->
<div class="container">
  <h1>Log Sources</h1>
  <div id="err" class="error" style="display:none"></div>

  <div class="grid">
    <div class="card">
      <h2>Upload</h2>
      <div class="row">
        <label for="tenant">Tenant</label>
        <input id="tenant" value="default" aria-label="Tenant ID"/>
        <input id="file" type="file" aria-label="Log file"/>
        <button id="load-file">Load</button>
      </div>
      <textarea id="input" rows="10" placeholder="Paste logs here (one per line)" aria-label="Log input" data-testid="sample-input"></textarea>
      <div class="row">
        <button id="detect" data-testid="detect-btn">Detect</button>
        <span id="det-ribbon" class="ribbon" style="display:none"></span>
      </div>
      <div id="signals"></div>
    </div>

    <div class="card">
      <h2>JSON Path Helper</h2>
      <div class="small">Click a key to insert an operator into the Query Bar</div>
      <div class="sidebar" id="json-keys"></div>
    </div>
  </div>

  <div class="card">
    <h2>Normalize Preview <span id="cov" class="pill warn" data-testid="coverage-pill">cov: …</span></h2>
    <div class="row">
      <button id="preview" data-testid="normalize-btn">Preview first 20</button>
    </div>
    <div style="overflow:auto">
      <table aria-label="Normalized preview table" data-testid="preview-table">
        <thead>
          <tr id="head"></tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h2>Query Builder</h2>
    <textarea id="dsl" rows="6" aria-label="Query DSL" data-testid="query"></textarea>
    <div class="row">
      <button id="compile">Compile</button>
      <button id="execute" data-testid="dryrun-btn">Execute (Dry-run)</button>
      <span id="rcnt" class="badge">rows: …</span>
    </div>
    <pre id="sql" style="white-space:pre-wrap"></pre>
  </div>

  <div class="card">
    <h2>Load Guidance</h2>
    <pre id="cli"></pre>
  </div>

  <div id="toast" class="toast"></div>
</div>

<script src="/dev/ui/assets/api.js"></script>
<script>
// Helper button to insert a common json_meta token
const helperBtn = document.createElement('button');
helperBtn.id = 'insert-ua';
helperBtn.setAttribute('data-testid','json-helper');
helperBtn.textContent = 'Insert UA helper';
document.querySelector('.card h2 + .small')?.parentElement?.appendChild(helperBtn);
helperBtn.onclick = (e)=>{
  e.preventDefault();
  const cur = $('#dsl').value.trim();
  const token = '{"op":"jsoneq","args":["metadata.http.user_agent","Mozilla"]}';
  $('#dsl').value = cur ? cur+"\n"+token : token;
}
const $ = s => document.querySelector(s);
const err = (m)=>{ const e=$('#err'); e.textContent=m; e.style.display='block'; };
const clearErr = ()=>{ const e=$('#err'); e.style.display='none'; e.textContent=''; };

function getLines(){
  const txt = $('#input').value.trim();
  return txt ? txt.split('\n').filter(Boolean) : [];
}

$('#load-file').onclick = ()=>{
  clearErr();
  const f = $('#file').files[0]; if(!f){ return; }
  const r = new FileReader();
  r.onload = ()=>{ $('#input').value = r.result; };
  r.readAsText(f);
};

$('#detect').onclick = async ()=>{
  clearErr();
  const lines = getLines(); if(lines.length===0){ err('No input lines'); return; }
  try {
    // Sample first line
    const body = { raw: lines[0] };
    const det = await UI.req('/api/v2/parse/detect', { body });
    $('#det-ribbon').style.display='inline-block';
    $('#det-ribbon').textContent = `${det.vendor}/${det.type} (conf ${Math.round(det.confidence*100)}%)`;
    $('#signals').innerHTML = (det.signals||[]).map(s=>`<span class="badge">${s}</span>`).join(' ');
    // CLI guidance
    const t = $('#tenant').value.trim()||'default';
    $('#cli').textContent = `# generate + load (example)\nsiem gen ${det.vendor}-${det.type} --seed 42 --count 200 --tenant ${t} --out /tmp/${det.vendor}.raw --out-ndjson /tmp/${det.vendor}.uem.ndjson\nsiem load-ch --file /tmp/${det.vendor}.uem.ndjson --table dev.events`;
  } catch(e){ err(`Detect failed (${e.status||'err'})`); }
};

$('#preview').onclick = async ()=>{
  clearErr();
  const lines = getLines().slice(0,20); if(lines.length===0){ err('No input lines'); return; }
  const t = $('#tenant').value.trim()||'default';
  try {
    const body = { tenant_id: t, records: lines };
    const res = await UI.req('/api/v2/parse/normalize', { body });
    const rows = res.records || [];
    const cov = res.coverage || 0; const pill=$('#cov'); pill.textContent = `cov: ${Math.round(cov*100)/100}`; pill.className = `pill ${cov>=0.95?'ok':'warn'}`;
    // Build table
    const cols = ["event_id","event_timestamp","tenant_id","event_category","event_action","event_outcome","source_ip","destination_ip","user_id","user_name","severity","message","source_type","created_at","retention_days"];
    $('#head').innerHTML = cols.map(c=>`<th>${c}</th>`).join('');
    $('#rows').innerHTML = rows.map(r=>{
      return `<tr>`+cols.map(c=>{
        const v = r[c];
        const show = (v===null || v===undefined || v==='') ? `<span class=missing>missing</span>` : String(v);
        return `<td>${show}</td>`;
      }).join('')+`</tr>`;
    }).join('');

    // Discover JSON keys for helper
    const keys = new Set();
    (rows||[]).slice(0,3).forEach(r=>{
      try { const md = JSON.parse(r.metadata||'{}');
        function walk(o, pfx){ Object.entries(o||{}).forEach(([k,v])=>{
          const p = pfx?`${pfx}.${k}`:k; if(typeof v==='object' && v){ walk(v,p); } else { keys.add(`metadata.${p}`); }
        }); }
        walk(md,'');
      } catch{}
    });
    $('#json-keys').innerHTML = Array.from(keys).sort().slice(0,200).map(k=>`<div><a href="#" data-k="${k}">${k}</a></div>`).join('');
    $('#json-keys').querySelectorAll('a').forEach(a=>{
      a.onclick = (e)=>{ e.preventDefault(); const k=e.target.getAttribute('data-k');
        const op = k.startsWith('metadata.') ? `{"op":"jsoneq","args":["${k}",""]}` : `{"op":"jsoneq","args":["raw_event.${k}",""]}`;
        const cur=$('#dsl').value.trim(); $('#dsl').value = cur? cur+"\n"+op : op; };
    });
  } catch(e){ err(`Normalize failed (${e.status||'err'})`); }
};

$('#compile').onclick = async ()=>{
  clearErr();
  try {
    const dsl = { version:"1", search: { tenant_ids:[($('#tenant').value.trim()||'default')], time_range:{last_seconds:900}, where: JSON.parse($('#dsl').value||'{}') } };
    const res = await UI.searchCompile(dsl);
    $('#sql').textContent = res.sql || JSON.stringify(res,null,2);
  } catch(e){ err(`Compile failed (${e.status||'err'})`); }
};

$('#execute').onclick = async ()=>{
  clearErr();
  try {
    const dsl = { version:"1", search: { tenant_ids:[($('#tenant').value.trim()||'default')], time_range:{last_seconds:900}, where: JSON.parse($('#dsl').value||'{}') } };
    const r = await UI.searchEstimate(dsl);
    $('#rcnt').textContent = `rows: ${r.estimated_rows}`;
  } catch(e){ err(`Execute failed (${e.status||'err'})`); }
};
</script>
</body>
</html>


