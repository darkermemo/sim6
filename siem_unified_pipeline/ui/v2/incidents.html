<!doctype html><meta charset="utf-8" />
<title>Incidents Â· v2</title>
<style>
 body{font:14px system-ui;margin:16px;color:#1b1f23}
 header{display:flex;gap:8px;align-items:center;margin-bottom:12px}
 input,select,button{padding:6px 8px;border:1px solid #d0d7de;border-radius:8px}
 table{border-collapse:collapse;width:100%} th,td{padding:8px;border-bottom:1px solid #eee}
 tr:hover{background:#f8fafc}
 .chip{display:inline-block;padding:2px 6px;border-radius:999px;background:#eef;border:1px solid #ccd;margin-right:4px}
 a{text-decoration:none;color:#0366d6}
</style>
<header>
  <h2 style="margin:0">Incidents</h2>
  <input id="tenant" value="default" />
  <select id="status">
    <option value="">(any status)</option>
    <option>OPEN</option><option>TRIAGED</option><option>IN_PROGRESS</option>
    <option>CONTAINED</option><option>RESOLVED</option><option>CLOSED</option>
  </select>
  <button onclick="loadIncidents()">Refresh</button>
  <a href="admin.html" style="margin-left:auto">Admin</a>
  <a href="../events.html">Events</a>
  <a href="../alerts.html">Alerts</a>
</header>
<table id="grid"><thead><tr>
  <th>ID</th><th>Title</th><th>Severity</th><th>Status</th><th>Owner</th>
  <th>Alerts</th><th>Last Seen</th><th>Entities</th>
</tr></thead><tbody></tbody></table>
<script>
const BASE='/api/v2';
async function loadIncidents(){
  const t=document.getElementById('tenant').value.trim();
  const s=document.getElementById('status').value;
  const url=`${BASE}/incidents?tenant_id=${encodeURIComponent(t)}${s?`&status=${s}`:''}&limit=100`;
  const r=await fetch(url); const j=await r.json();
  const tb=document.querySelector('#grid tbody'); tb.innerHTML='';
  (j.incidents||[]).forEach(x=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td><a href="incident.html?id=${encodeURIComponent(x.incident_id)}&tenant_id=${encodeURIComponent(x.tenant_id)}">${x.incident_id}</a></td>
      <td>${x.title||''}</td>
      <td>${x.severity}</td>
      <td>${x.status}</td>
      <td>${x.owner}</td>
      <td>${x.alert_count}</td>
      <td>${new Date(x.last_alert_ts*1000).toLocaleString()}</td>
      <td>${renderEntities(x.entities)}</td>`;
    tb.appendChild(tr);
  });
}
function renderEntities(s){ try{const o=JSON.parse(s||'{}'); return Object.entries(o).map(([k,v])=>`<span class="chip">${k}:${v}</span>`).join('');}catch{return ''} }
loadIncidents(); setInterval(loadIncidents, 10000);
</script>


