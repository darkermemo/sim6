<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIEM Codebase Audit Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/chart.js"></script>
    <style>
        .severity-critical { @apply bg-red-100 border-red-500 text-red-800; }
        .severity-high { @apply bg-orange-100 border-orange-500 text-orange-800; }
        .severity-medium { @apply bg-yellow-100 border-yellow-500 text-yellow-800; }
        .severity-low { @apply bg-blue-100 border-blue-500 text-blue-800; }
        .severity-info { @apply bg-gray-100 border-gray-500 text-gray-800; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">SIEM Codebase Audit Dashboard</h1>
            <p class="text-gray-600">Comprehensive analysis of SQL queries, API endpoints, UI elements, and security issues</p>
            <div class="mt-4 text-sm text-gray-500">
                <span id="generated-date"></span>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">SQL Queries</p>
                        <p class="text-2xl font-semibold text-gray-900" id="sql-count">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-green-100 rounded-lg">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">API Endpoints</p>
                        <p class="text-2xl font-semibold text-gray-900" id="api-count">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">UI Elements</p>
                        <p class="text-2xl font-semibold text-gray-900" id="ui-count">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-red-100 rounded-lg">
                        <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Issues Found</p>
                        <p class="text-2xl font-semibold text-gray-900" id="issues-count">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Filters</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="category-filter" class="w-full border border-gray-300 rounded-md px-3 py-2">
                        <option value="all">All Categories</option>
                        <option value="queries">SQL Queries</option>
                        <option value="api">API Endpoints</option>
                        <option value="ui">UI Elements</option>
                        <option value="issues">Issues</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Severity</label>
                    <select id="severity-filter" class="w-full border border-gray-300 rounded-md px-3 py-2">
                        <option value="all">All Severities</option>
                        <option value="critical">Critical</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                    <input type="text" id="search-filter" placeholder="Search..." class="w-full border border-gray-300 rounded-md px-3 py-2">
                </div>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="space-y-8">
            <!-- SQL Queries Section -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">SQL Queries</h2>
                </div>
                <div class="p-6">
                    <div id="queries-content" class="space-y-4"></div>
                </div>
            </div>

            <!-- API Endpoints Section -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">API Endpoints</h2>
                </div>
                <div class="p-6">
                    <div id="api-content" class="space-y-4"></div>
                </div>
            </div>

            <!-- UI Elements Section -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">UI Elements</h2>
                </div>
                <div class="p-6">
                    <div id="ui-content" class="space-y-4"></div>
                </div>
            </div>

            <!-- Issues Section -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">Issues & Recommendations</h2>
                </div>
                <div class="p-6">
                    <div id="issues-content" class="space-y-4"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let auditData = null;
        let filteredData = null;

        // Load audit data
        async function loadAuditData() {
            try {
                const response = await fetch('./codebase_audit_report.json');
                auditData = await response.json();
                initializeDashboard();
            } catch (error) {
                console.error('Failed to load audit data:', error);
                document.body.innerHTML = '<div class="container mx-auto px-4 py-8"><div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">Failed to load audit data. Please ensure codebase_audit_report.json is in the same directory.</div></div>';
            }
        }

        function initializeDashboard() {
            updateSummaryCards();
            renderContent();
            setupFilters();
            document.getElementById('generated-date').textContent = `Generated: ${new Date().toLocaleString()}`;
        }

        function updateSummaryCards() {
            const sqlCount = (auditData.queries?.clickhouse_queries?.length || 0) + (auditData.queries?.general_sql_patterns?.length || 0);
            const apiCount = auditData.api_endpoints?.length || 0;
            const uiCount = auditData.ui_clickable_elements?.length || 0;
            const issuesCount = (auditData.data_context_mismatches?.length || 0) + (auditData.other_issues?.length || 0);

            document.getElementById('sql-count').textContent = sqlCount;
            document.getElementById('api-count').textContent = apiCount;
            document.getElementById('ui-count').textContent = uiCount;
            document.getElementById('issues-count').textContent = issuesCount;
        }

        function renderContent() {
            renderQueries();
            renderApiEndpoints();
            renderUiElements();
            renderIssues();
        }

        function renderQueries() {
            const container = document.getElementById('queries-content');
            const queries = [...(auditData.queries?.clickhouse_queries || []), ...(auditData.queries?.general_sql_patterns || [])];
            
            container.innerHTML = queries.map(query => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-medium text-gray-900">${query.mapped_action || query.description || 'Query'}</h3>
                        <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded">${query.type}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${query.file}${query.line ? `:${query.line}` : ''}</p>
                    <pre class="bg-gray-50 p-3 rounded text-sm overflow-x-auto"><code>${query.query}</code></pre>
                </div>
            `).join('');
        }

        function renderApiEndpoints() {
            const container = document.getElementById('api-content');
            const endpoints = auditData.api_endpoints || [];
            
            container.innerHTML = endpoints.map(endpoint => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-medium text-gray-900">${endpoint.endpoint}</h3>
                        <div class="flex space-x-2">
                            <span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded">${endpoint.method}</span>
                            <span class="px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 rounded">${endpoint.crud_classification}</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${endpoint.file}</p>
                    <div class="text-sm text-gray-700">
                        <strong>UI Elements:</strong> ${endpoint.ui_elements.join(', ')}
                    </div>
                </div>
            `).join('');
        }

        function renderUiElements() {
            const container = document.getElementById('ui-content');
            const elements = auditData.ui_clickable_elements || [];
            
            container.innerHTML = elements.map(element => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-medium text-gray-900">${element.element_type}</h3>
                        <span class="px-2 py-1 text-xs font-medium ${element.handler_status === 'missing' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'} rounded">
                            ${element.handler_status === 'missing' ? 'Missing Handler' : 'Handler Present'}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${element.file}</p>
                    <p class="text-sm text-gray-700"><strong>Handler:</strong> ${element.handler}</p>
                    <p class="text-sm text-gray-700"><strong>Purpose:</strong> ${element.purpose}</p>
                </div>
            `).join('');
        }

        function renderIssues() {
            const container = document.getElementById('issues-content');
            const mismatches = auditData.data_context_mismatches || [];
            const otherIssues = auditData.other_issues || [];
            
            const allIssues = [
                ...mismatches.map(issue => ({...issue, category: 'Data Mismatch', severity: 'high'})),
                ...otherIssues.map(issue => ({...issue, category: 'Other Issue', severity: issue.severity || 'medium'}))
            ];
            
            container.innerHTML = allIssues.map(issue => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-medium text-gray-900">${issue.issue || issue.description}</h3>
                        <div class="flex space-x-2">
                            <span class="px-2 py-1 text-xs font-medium severity-${issue.severity} border rounded">${issue.severity.toUpperCase()}</span>
                            <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded">${issue.category}</span>
                        </div>
                    </div>
                    ${issue.files ? `<p class="text-sm text-gray-600 mb-2"><strong>Files:</strong> ${issue.files.join(', ')}</p>` : ''}
                    ${issue.examples ? `<p class="text-sm text-gray-600 mb-2"><strong>Examples:</strong> ${issue.examples.join(', ')}</p>` : ''}
                    ${issue.suggested_fix ? `<p class="text-sm text-gray-700"><strong>Suggested Fix:</strong> ${issue.suggested_fix}</p>` : ''}
                </div>
            `).join('');
        }

        function setupFilters() {
            const categoryFilter = document.getElementById('category-filter');
            const severityFilter = document.getElementById('severity-filter');
            const searchFilter = document.getElementById('search-filter');

            [categoryFilter, severityFilter, searchFilter].forEach(filter => {
                filter.addEventListener('change', applyFilters);
                filter.addEventListener('input', applyFilters);
            });
        }

        function applyFilters() {
            const category = document.getElementById('category-filter').value;
            const severity = document.getElementById('severity-filter').value;
            const search = document.getElementById('search-filter').value.toLowerCase();

            // Show/hide sections based on category filter
            const sections = {
                'queries': document.querySelector('#queries-content').closest('.bg-white'),
                'api': document.querySelector('#api-content').closest('.bg-white'),
                'ui': document.querySelector('#ui-content').closest('.bg-white'),
                'issues': document.querySelector('#issues-content').closest('.bg-white')
            };

            Object.entries(sections).forEach(([key, section]) => {
                if (category === 'all' || category === key) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });

            // Apply search and severity filters to visible content
            // This is a simplified implementation - in a real app you'd want more sophisticated filtering
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', loadAuditData);
    </script>
</body>
</html>