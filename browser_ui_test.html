<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIEM UI Testing Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f9f9f9;
            border-radius: 3px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            color: white;
            font-weight: bold;
        }
        .status.pass { background-color: #28a745; }
        .status.fail { background-color: #dc3545; }
        .status.pending { background-color: #ffc107; color: black; }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç SIEM UI Testing Dashboard</h1>
        <p>This tool helps systematically test all UI pages and API endpoints.</p>
        
        <div class="test-section">
            <h2>üåê Server Status</h2>
            <div class="test-item">
                <span>UI Server (http://localhost:3000/)</span>
                <span id="ui-status" class="status pending">Checking...</span>
            </div>
            <div class="test-item">
                <span>API Server (http://localhost:8081/)</span>
                <span id="api-status" class="status pending">Checking...</span>
            </div>
            <button class="test-button" onclick="checkServers()">Check Servers</button>
        </div>

        <div class="test-section">
            <h2>üìÑ Page Accessibility Tests</h2>
            <div id="page-tests">
                <!-- Page tests will be populated here -->
            </div>
            <button class="test-button" onclick="testAllPages()">Test All Pages</button>
            <button class="test-button" onclick="openUIInNewTab()">Open UI in New Tab</button>
        </div>

        <div class="test-section">
            <h2>üîå API Endpoint Tests</h2>
            <div id="api-tests">
                <!-- API tests will be populated here -->
            </div>
            <button class="test-button" onclick="testAllAPIs()">Test All APIs</button>
        </div>

        <div class="test-section">
            <h2>üìä Test Results</h2>
            <div id="test-summary">
                <p>No tests run yet.</p>
            </div>
        </div>

        <div class="test-section">
            <h2>üìù Test Log</h2>
            <div id="test-log" class="log-area">
                <p>Test log will appear here...</p>
            </div>
            <button class="test-button" onclick="clearLog()">Clear Log</button>
        </div>
    </div>

    <script>
        const pages = [
            { name: 'Dashboard', path: 'dashboard' },
            { name: 'Alerts', path: 'alerts' },
            { name: 'Cases', path: 'cases' },
            { name: 'Admin', path: 'admin' },
            { name: 'Rules', path: 'rules' },
            { name: 'Log Sources', path: 'log-sources' },
            { name: 'Users', path: 'users' },
            { name: 'Parsers', path: 'parsers' },
            { name: 'Interactive Parser', path: 'interactive-parser' },
            { name: 'Events', path: 'events' },
            { name: 'Log Activity', path: 'log-activity' },
            { name: 'Vendor Mapping', path: 'vendor-mapping' },
            { name: 'Agent Fleet', path: 'agent-fleet' }
        ];

        const apiEndpoints = [
            { name: 'Dashboard', url: '/api/v1/dashboard', method: 'GET' },
            { name: 'Events Search', url: '/api/v1/events/search', method: 'GET' },
            { name: 'Alerts', url: '/api/v1/alerts', method: 'GET' },
            { name: 'Rules', url: '/api/v1/rules', method: 'GET' },
            { name: 'Log Sources', url: '/api/v1/log-sources', method: 'GET' },
            { name: 'Users', url: '/api/v1/users', method: 'GET' },
            { name: 'Parsers', url: '/api/v1/parsers', method: 'GET' },
            { name: 'Agents', url: '/api/v1/agents', method: 'GET' },
            { name: 'Cases', url: '/api/v1/cases', method: 'GET' },
            { name: 'Health Check', url: '/health', method: 'GET' }
        ];

        let testResults = {
            pages: {},
            apis: {},
            servers: {}
        };

        function log(message, type = 'info') {
            const logArea = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '<p>Test log cleared...</p>';
        }

        function updateStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            element.className = `status ${status}`;
            element.textContent = text;
        }

        async function checkServers() {
            log('Checking server status...', 'info');
            
            // Check UI Server
            try {
                const uiResponse = await fetch('http://localhost:3000/', { mode: 'no-cors' });
                updateStatus('ui-status', 'pass', 'Online');
                testResults.servers.ui = true;
                log('UI Server: Online', 'success');
            } catch (error) {
                updateStatus('ui-status', 'fail', 'Offline');
                testResults.servers.ui = false;
                log(`UI Server: Offline - ${error.message}`, 'error');
            }

            // Check API Server
            try {
                const apiResponse = await fetch('http://localhost:8081/health');
                if (apiResponse.ok) {
                    updateStatus('api-status', 'pass', 'Online');
                    testResults.servers.api = true;
                    log('API Server: Online', 'success');
                } else {
                    updateStatus('api-status', 'fail', `Error ${apiResponse.status}`);
                    testResults.servers.api = false;
                    log(`API Server: Error ${apiResponse.status}`, 'error');
                }
            } catch (error) {
                updateStatus('api-status', 'fail', 'Offline');
                testResults.servers.api = false;
                log(`API Server: Offline - ${error.message}`, 'error');
            }
        }

        function initializePageTests() {
            const container = document.getElementById('page-tests');
            container.innerHTML = '';
            
            pages.forEach(page => {
                const testItem = document.createElement('div');
                testItem.className = 'test-item';
                testItem.innerHTML = `
                    <span>${page.name} (${page.path})</span>
                    <span id="page-${page.path}" class="status pending">Not Tested</span>
                `;
                container.appendChild(testItem);
            });
        }

        function initializeAPITests() {
            const container = document.getElementById('api-tests');
            container.innerHTML = '';
            
            apiEndpoints.forEach(api => {
                const testItem = document.createElement('div');
                testItem.className = 'test-item';
                testItem.innerHTML = `
                    <span>${api.name} (${api.method} ${api.url})</span>
                    <span id="api-${api.name.replace(/\s+/g, '-').toLowerCase()}" class="status pending">Not Tested</span>
                `;
                container.appendChild(testItem);
            });
        }

        async function testAllPages() {
            log('Starting page accessibility tests...', 'info');
            
            for (const page of pages) {
                await testPage(page);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            updateTestSummary();
            log('Page tests completed', 'success');
        }

        async function testPage(page) {
            const statusId = `page-${page.path}`;
            log(`Testing page: ${page.name}`, 'info');
            
            try {
                // Since we can't directly navigate in this context, we'll test if the UI server responds
                const response = await fetch(`http://localhost:3000/`, { mode: 'no-cors' });
                updateStatus(statusId, 'pass', 'Accessible');
                testResults.pages[page.path] = { status: 'pass', error: null };
                log(`‚úÖ ${page.name}: Accessible`, 'success');
            } catch (error) {
                updateStatus(statusId, 'fail', 'Error');
                testResults.pages[page.path] = { status: 'fail', error: error.message };
                log(`‚ùå ${page.name}: ${error.message}`, 'error');
            }
        }

        async function testAllAPIs() {
            log('Starting API endpoint tests...', 'info');
            
            for (const api of apiEndpoints) {
                await testAPI(api);
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            updateTestSummary();
            log('API tests completed', 'success');
        }

        async function testAPI(api) {
            const statusId = `api-${api.name.replace(/\s+/g, '-').toLowerCase()}`;
            log(`Testing API: ${api.name}`, 'info');
            
            try {
                const response = await fetch(`http://localhost:8081${api.url}`, {
                    method: api.method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    updateStatus(statusId, 'pass', `${response.status}`);
                    testResults.apis[api.name] = { status: 'pass', code: response.status };
                    log(`‚úÖ ${api.name}: ${response.status}`, 'success');
                } else {
                    updateStatus(statusId, 'fail', `${response.status}`);
                    testResults.apis[api.name] = { status: 'fail', code: response.status };
                    log(`‚ö†Ô∏è ${api.name}: ${response.status} ${response.statusText}`, 'warning');
                }
            } catch (error) {
                updateStatus(statusId, 'fail', 'Error');
                testResults.apis[api.name] = { status: 'fail', error: error.message };
                log(`‚ùå ${api.name}: ${error.message}`, 'error');
            }
        }

        function updateTestSummary() {
            const summary = document.getElementById('test-summary');
            
            const pagesPassed = Object.values(testResults.pages).filter(r => r.status === 'pass').length;
            const pagesFailed = Object.values(testResults.pages).filter(r => r.status === 'fail').length;
            const apisPassed = Object.values(testResults.apis).filter(r => r.status === 'pass').length;
            const apisFailed = Object.values(testResults.apis).filter(r => r.status === 'fail').length;
            
            summary.innerHTML = `
                <h3>Summary</h3>
                <p><strong>Pages:</strong> ${pagesPassed} passed, ${pagesFailed} failed</p>
                <p><strong>APIs:</strong> ${apisPassed} passed, ${apisFailed} failed</p>
                <p><strong>Overall Status:</strong> ${(pagesFailed === 0 && apisFailed === 0) ? '‚úÖ All tests passed' : '‚ùå Some tests failed'}</p>
            `;
        }

        function openUIInNewTab() {
            window.open('http://localhost:3000/', '_blank');
            log('Opened UI in new tab for manual testing', 'info');
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializePageTests();
            initializeAPITests();
            checkServers();
            log('UI Testing Dashboard initialized', 'success');
        });
    </script>
</body>
</html>